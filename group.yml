# switches for experimental Doozer features
doozer_feature_gates:
  # odcs_enabled: whether to enable Doozer ODCS support (without explicitly specifying --odcs-mode option)
  # See https://issues.redhat.com/browse/ART-128 for more information about ODCS mode.
  odcs_enabled: false
  # odcs_aggressive: true to build an image with ODCS auto mode even if its image config doesn't have `odcs` field defined
  odcs_aggressive: true

advisories:
  rpm: -1
  image: 87319
  # security: 46350

signing_advisory: 66483

build_profiles:
  image:
    unsigned:
      targets:
      - rhaos-{MAJOR}.{MINOR}-rhel-7-containers-candidate
      signing_intent: unsigned
      repo_type: unsigned
    signed:
      targets:
      - rhaos-{MAJOR}.{MINOR}-rhel-7-signed-containers-candidate
      signing_intent: release
      repo_type: signed
  rpm:
    default:
      targets:
      - rhaos-{MAJOR}.{MINOR}-rhel-7-candidate

default_image_build_profile: unsigned
default_rpm_build_profile: default

arches:
- x86_64
branch: rhaos-{MAJOR}.{MINOR}-rhel-7
default_image_build_method: imagebuilder
name: openshift-{MAJOR}.{MINOR}
insecure_source: true
dist_git_ignore:
  - gating.yaml
urls:
  brewhub: https://brewhub.engineering.redhat.com/brewhub
  brew_image_host: registry-proxy.engineering.redhat.com
  brew_image_namespace: rh-osbs
  cgit: http://pkgs.devel.redhat.com/cgit
non_release:
  images:
  - openshift-enterprise-base
  rpms:
  - golang-scl-shim
push:
  registries:
  - registry.reg-aws.openshift.com:443
sources:
  ose:
    url: git@github.com:openshift/ose.git
    branch:
      target: enterprise-{MAJOR}.{MINOR}
      fallback: master
repos:
  rhel-7-server-ansible-2.8-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/ansible/2.8/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/ansible/2.8/os/
    content_set:
      default: rhel-7-server-ansible-2.8-rpms
      ppc64le: rhel-7-server-ansible-2.8-for-power-le-rpms
    reposync:
      enabled: false
  rhel-7-server-ansible-2.9-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/ansible/2.9/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/ansible/2.9/os/
    content_set:
      default: rhel-7-server-ansible-2.9-rpms
      ppc64le: rhel-7-server-ansible-2.9-for-power-le-rpms
    reposync:
      enabled: false
  rhel-7-server-rhceph-3-tools-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/els/rhel/power-le/7/7Server/ppc64le/rhceph-tools/3/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/els/rhel/server/7/7Server/x86_64/rhceph-tools/3/os/
    content_set:
      default: rhel-7-server-rhceph-3-tools-els-rpms
      optional: true
      ppc64le: rhel-7-server-rhceph-3-for-power-le-tools-els-rpms
    reposync:
      enabled: false
  rhel-fast-datapath-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/fast-datapath/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/fast-datapath/os/
    content_set:
      default: rhel-7-fast-datapath-rpms
      ppc64le: rhel-7-for-power-le-fast-datapath-rpms
    reposync:
      enabled: false
  rhel-openstack-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/openstack/14/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/openstack/14/os/
    content_set:
      default: rhel-7-server-openstack-14-rpms
      optional: true
      ppc64le: rhel-7-server-openstack-14-for-power-le-rpms
    reposync:
      enabled: false
  rhel-server-extras-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/extras/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/extras/os/
    content_set:
      default: rhel-7-server-extras-rpms
      ppc64le: rhel-7-for-power-le-extras-rpms
    reposync:
      enabled: false
  rhel-server-optional-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/optional/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/optional/os/
      enabled: 1
    content_set:
      default: rhel-7-server-optional-rpms
      ppc64le: rhel-7-for-power-le-optional-rpms
    reposync:
      enabled: false
  rhel-server-ose-rpms:
    conf:
      baseurl:
        ppc64le: http://download.lab.bos.redhat.com/rcm-guest/puddles/RHAOS/plashets/{MAJOR}.{MINOR}/building/ppc64le/os
        x86_64: http://download.lab.bos.redhat.com/rcm-guest/puddles/RHAOS/plashets/{MAJOR}.{MINOR}/building/x86_64/os
    content_set:
      default: rhel-7-server-ose-{MAJOR}.{MINOR}-rpms
      optional: true
      ppc64le: rhel-7-for-power-le-ose-{MAJOR}.{MINOR}-rpms
    reposync:
      enabled: false
  rhel-server-ose-rpms-embargoed:
    conf:
      baseurl:
        ppc64le: http://download.lab.bos.redhat.com/rcm-guest/puddles/RHAOS/plashets/{MAJOR}.{MINOR}/building-embargoed/ppc64le/os
        x86_64: http://download.lab.bos.redhat.com/rcm-guest/puddles/RHAOS/plashets/{MAJOR}.{MINOR}/building-embargoed/x86_64/os
    content_set:
      default: rhel-7-server-ose-{MAJOR}.{MINOR}-rpms
      optional: true
      ppc64le: rhel-7-for-power-le-ose-{MAJOR}.{MINOR}-rpms
    reposync:
      enabled: false
  rhel-server-rhscl-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/rhscl/1/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/rhscl/1/os/
    content_set:
      default: rhel-server-rhscl-7-rpms
      ppc64le: rhel-7-server-for-power-le-rhscl-rpms
    reposync:
      enabled: false
  rhel-server-rpms:
    conf:
      baseurl:
        ppc64le: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/power-le/7/7Server/ppc64le/os/
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/os/
      enabled: 1
    content_set:
      default: rhel-7-server-rpms
      ppc64le: rhel-7-for-power-le-rpms
    reposync:
      enabled: false
  rhel-server-ose-rpms-released:
    conf:
      baseurl:
        x86_64: http://rhsm-pulp.corp.redhat.com/content/dist/rhel/server/7/7Server/x86_64/ose/3.11/os/
      extra_options:
        module_hotfixes: 1
    content_set:
      default: rhel-7-server-ose-{MAJOR}.{MINOR}-rpms
      optional: true
    reposync:
      latest_only: true
vars:
  MAJOR: 3
  MINOR: 11
  IMPACT: Low
  CVES: None
image_build_log_scanner:
  matches:
    # yum failed to install a package (but may not give an error result)
  - "No package .* available"
    # on multiarch builds, installed different NVR of pkg for different arches:
  - "Failed component comparison for components:.*"
    # docker does not understand multi-stage builds
  - "is not a valid repository/tag: invalid reference format"
    # indicative of https://github.com/openshift/imagebuilder/issues/87 or file(s) missing
  - "plugins.imagebuilder.*lstat.*no such file or directory"
    # indicative of https://projects.engineering.redhat.com/browse/OSBS-7508
  - "Primary tag already exists in registry"
  files:
  - x86_64.log
  - ppc64le.log
  - task_failed.log
  - orchestrator.log
