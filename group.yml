freeze_automation: scheduled

vars:
  MAJOR: 4
  MINOR: 8
  IMPACT: Low
  CVES: None

arches:
- x86_64
- ppc64le
- s390x

operator_image_ref_mode: manifest-list
operator_channel_stable: extra

signing_advisory: 68847

build_profiles:
  image:
    unsigned:
      signing_intent: unsigned
      repo_type: unsigned
    signed:
      signing_intent: release
      repo_type: signed
  rpm:
    default:
      targets:
      - rhaos-{MAJOR}.{MINOR}-rhel-8-candidate
      hotfix_targets:
      - rhaos-{MAJOR}.{MINOR}-rhel-8-hotfix

assemblies:
  enabled: true

cachito:
  enabled: true

default_image_build_method: osbs2
default_image_build_profile: unsigned
default_rpm_build_profile: default

branch: rhaos-{MAJOR}.{MINOR}-rhel-8
name: openshift-{MAJOR}.{MINOR}
urls:
  brewhub: https://brewhub.engineering.redhat.com/brewhub
  brew_image_host: registry-proxy.engineering.redhat.com
  brew_image_namespace: rh-osbs
  cgit: https://pkgs.devel.redhat.com/cgit
dist_git_ignore:
  - gating.yaml

rhcos:
  enabled_repos:
  - rhel-8-baseos-rpms
  - rhel-8-appstream-rpms
  - rhel-8-rt-rpms
  - rhel-8-fast-datapath-rpms
  - rhel-8-server-ose-rpms
  require_consistency:
    driver-toolkit:
    - kernel
    - kernel-rt

push:
  registries: []
    # - quay.io/openshift-qe-optional-operators

sources:
  ose:
    url: git@github.com:openshift-priv/origin.git
    branch:
      target: release-{MAJOR}.{MINOR}

public_upstreams:
- private: "https://github.com/openshift-priv"
  public: "https://github.com/openshift"

repos:

  rhel-8-server-ansible-2.9-rpms:
    conf:
      baseurl:
        aarch64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/aarch64/ansible/2.9/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/ppc64le/ansible/2.9/os/
        s390x: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/s390x/ansible/2.9/os/
        x86_64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/x86_64/ansible/2.9/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: ansible-2.9-for-rhel-8-x86_64-rpms
      aarch64: ansible-2.9-for-rhel-8-aarch64-rpms
      ppc64le: ansible-2.9-for-rhel-8-ppc64le-rpms
      s390x: ansible-2.9-for-rhel-8-s390x-rpms
    reposync:
      enabled: false

  # Included to trigger reposync of rhel-8 rpms
  rhel-8-server-ose-rpms-embargoed:
    conf:
      baseurl:
        aarch64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8-embargoed/latest/aarch64/os
        ppc64le: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8-embargoed/latest/ppc64le/os
        s390x: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8-embargoed/latest/s390x/os
        x86_64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8-embargoed/latest/x86_64/os
      # Do not add ci_alignment here. These RPMs should not be installed except for internal builds.
    content_set:
      default: rhocp-{MAJOR}.{MINOR}-for-rhel-8-x86_64-rpms
      optional: true
      aarch64: rhocp-{MAJOR}.{MINOR}-for-rhel-8-aarch64-rpms
      ppc64le: rhocp-{MAJOR}.{MINOR}-for-rhel-8-ppc64le-rpms
      s390x: rhocp-{MAJOR}.{MINOR}-for-rhel-8-s390x-rpms
    reposync:
      enabled: false

  rhel-8-server-ose-rpms:
    conf:
      baseurl:
        aarch64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8/latest/aarch64/os
        ppc64le: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8/latest/ppc64le/os
        s390x: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8/latest/s390x/os
        x86_64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el8/latest/x86_64/os
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:  # keep empty to avoid being used in ART build or confusing elliott redundant content_set check
      optional: true
    reposync:
      latest_only: false

  # The installer team working with rhel-7 worker nodes needs rhel-7 rpms reposync'd.
  rhel-server-ose-rpms:
    conf:
      baseurl:
        aarch64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el7/latest/aarch64/os
        ppc64le: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el7/latest/ppc64le/os
        s390x: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el7/latest/s390x/os
        x86_64: https://ocp-artifacts.hosts.prod.psi.rdu2.redhat.com/pub/RHOCP/plashets/{MAJOR}.{MINOR}/{runtime_assembly}/el7/latest/x86_64/os
      ci_alignment:
        profiles:
        - el7
        localdev:
          enabled: true
    content_set:  # keep empty to avoid being used in ART build or confusing elliott redundant content_set check
      optional: true
    reposync:
      latest_only: false

  rhel-8-baseos-rpms:
    conf:
      baseurl:
        aarch64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/aarch64/baseos/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/ppc64le/baseos/os/
        s390x: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/s390x/baseos/os/
        x86_64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/x86_64/baseos/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: rhel-8-for-x86_64-baseos-eus-rpms__8_DOT_4
      aarch64: rhel-8-for-aarch64-baseos-eus-rpms__8_DOT_4
      ppc64le: rhel-8-for-ppc64le-baseos-eus-rpms__8_DOT_4
      s390x: rhel-8-for-s390x-baseos-eus-rpms__8_DOT_4
    reposync:
      enabled: false

  rhel-8-codeready-builder-rpms:
    conf:
      baseurl:
        aarch64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/aarch64/codeready-builder/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/ppc64le/codeready-builder/os/
        s390x: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/s390x/codeready-builder/os/
        x86_64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/x86_64/codeready-builder/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: codeready-builder-for-rhel-8-x86_64-eus-rpms__8_DOT_4
      aarch64: codeready-builder-for-rhel-8-aarch64-eus-rpms__8_DOT_4
      ppc64le: codeready-builder-for-rhel-8-ppc64le-eus-rpms__8_DOT_4
      s390x: codeready-builder-for-rhel-8-s390x-eus-rpms__8_DOT_4
    reposync:
      enabled: false

  rhel-8-rt-rpms:
    conf:
      baseurl:
        x86_64: https://rhsm-pulp.corp.redhat.com/content/tus/rhel8/8.4/x86_64/rt/os/
        # other arches don't exist, pointing at something that exists
        s390x: https://rhsm-pulp.corp.redhat.com/content/tus/rhel8/8.4/x86_64/rt/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/tus/rhel8/8.4/x86_64/rt/os/
        aarch64: https://rhsm-pulp.corp.redhat.com/content/tus/rhel8/8.4/x86_64/rt/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: rhel-8-for-x86_64-rt-tus-rpms__8_DOT_4
      # don't have content set for other arches
      optional: true

  rhel-8-appstream-rpms:
    conf:
      baseurl:
        aarch64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/aarch64/appstream/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/ppc64le/appstream/os/
        s390x: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/s390x/appstream/os/
        x86_64: https://rhsm-pulp.corp.redhat.com/content/eus/rhel8/8.4/x86_64/appstream/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: rhel-8-for-x86_64-appstream-eus-rpms__8_DOT_4
      aarch64: rhel-8-for-aarch64-appstream-eus-rpms__8_DOT_4
      ppc64le: rhel-8-for-ppc64le-appstream-eus-rpms__8_DOT_4
      s390x: rhel-8-for-s390x-appstream-eus-rpms__8_DOT_4
    reposync:
      enabled: false

  rhel-8-fast-datapath-rpms:
    conf:
      baseurl:
        x86_64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/x86_64/fast-datapath/os/
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/ppc64le/fast-datapath/os/
        s390x: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/s390x/fast-datapath/os/
        # Trying to solve the problem of a missing repomd.xml
        # See: https://github.com/openshift/release/pull/17851
        # See: https://github.com/openshift/os/pull/541#issuecomment-823601083
        aarch64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/aarch64/fast-datapath/os/
        # [lmeyer] multi-arch releases might lag behind x86_64, which may require pointing at pre-release MA composes.
        # however this must be a temporary solution only; will cause mismatches after further releases if left that way.
        # ppc64le: https://download.lab.bos.redhat.com/rcm-guest/puddles/Multi-Arch/Fast-DataPath/EL8-Production/latest/ppc64le/os/
        # s390x: https://download.lab.bos.redhat.com/rcm-guest/puddles/Multi-Arch/Fast-DataPath/EL8-Production/latest/s390x/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: fast-datapath-for-rhel-8-x86_64-rpms
      aarch64: fast-datapath-for-rhel-8-aarch64-rpms
      ppc64le: fast-datapath-for-rhel-8-ppc64le-rpms
      s390x: fast-datapath-for-rhel-8-s390x-rpms
      optional: true
    reposync:
      enabled: true

  openstack-16-for-rhel-8-rpms:
    conf:
      baseurl:
        ppc64le: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/ppc64le/openstack/16/os/
        x86_64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/x86_64/openstack/16/os/
        # XXX: aarch64 and s390x don't exist, point it at something that exists so yum doesn't choke
        s390x: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/x86_64/openstack/16/os/
        aarch64: https://rhsm-pulp.corp.redhat.com/content/dist/layered/rhel8/x86_64/openstack/16/os/
      ci_alignment:
        profiles:
        - el8
        localdev:
          enabled: true
    content_set:
      default: openstack-16-for-rhel-8-x86_64-rpms
      ppc64le: openstack-16-for-rhel-8-ppc64le-rpms
      # don't have content set for aarch64 or s390x
      optional: true

image_build_log_scanner:
  matches:
    # yum failed to install a package (but may not give an error result)
  - "No package .* available"
    # dnf failed to find a package to install:
  - "Error: Unable to find a match"
    # on multiarch builds, installed different NVR of pkg for different arches:
  - "Failed component comparison for components:.*"
    # docker does not understand multi-stage builds
  - "is not a valid repository/tag: invalid reference format"
    # indicative of https://github.com/openshift/imagebuilder/issues/87 or file(s) missing
  - "plugins.imagebuilder.*lstat.*no such file or directory"
    # koji sucks at auto-incrementing releases
  - "bump_release: BuildError.'Unable to increment release value:"
    # need to add the image component to whitelist building into candidate tag
  - "not in list for tag rhaos-.*-candidate"
  files:
  - x86_64.log
  - s390x.log
  - ppc64le.log
  - task_failed.log
  - orchestrator.log
scan_freshness:
  release_regex: '(?x) ^ (\d\d\d\d) (\d\d) (\d\d) (\d\d)'
  threshold_hours: 6
csv_namespace: openshift
# whether and how to check if all buildroots have consistent versions of golang compilers (rpm build only)
# "x.y" (default): only major and minor version; "exact": the z-version must be the same; "no": do not check
check_golang_versions: "exact"
