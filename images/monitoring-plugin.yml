cachito:
  enabled: true
  packages:
    npm:
    - path: web
    gomod:
    - path: .
content:
  source:
    dockerfile: Dockerfile.art
    git:
      branch:
        target: release-{MAJOR}.{MINOR}
      url: git@github.com:openshift-priv/monitoring-plugin.git
      web: https://github.com/openshift/monitoring-plugin
    modifications:
    - action: replace
      match: "COPY $REMOTE_SOURCES $REMOTE_SOURCES_DIR"
      replacement: |-
        COPY $REMOTE_SOURCES $REMOTE_SOURCES_DIR
        RUN touch $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/registry-ca.pem $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/web/registry-ca.pem $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/web/.npmrc
    - action: replace
      match: "ENV HUSKY=0"
      replacement: |-
        ENV HUSKY=0
        RUN test -d $REMOTE_SOURCES_DIR/cachito-gomod-with-deps || exit 1;     cp -f $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/registry-ca.pem .  && cp -f $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/web/package-lock.json web/  && cp -f $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/app/web/package-lock.json web/
        RUN source $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/cachito.env  && make install-frontend-ci || echo "failed install"
        RUN source $REMOTE_SOURCES_DIR/cachito-gomod-with-deps/cachito.env  && make build-frontend || echo "failed build"
        RUN env
        RUN cat /opt/app-root/src/.npm/_logs/*.log
    ci_alignment:
      streams_prs:
        ci_build_root:
          member: ci-openshift-build-root-latest.rhel9
    pkg_managers:
    - npm
    - gomod
    okd_alignment:
      dockerfile: Dockerfile
distgit:
  branch: rhaos-{MAJOR}.{MINOR}-rhel-9
  component: monitoring-plugin-container
delivery:
  # Maps to honeybadger repo_name
  repo_name: ose-monitoring-plugin
  delivery_repo_names:
  - openshift4/ose-monitoring-plugin-rhel9
for_payload: true
from:
  builder:
  - member: openshift-base-nodejs.rhel9
  - stream: rhel-9-golang
  member: openshift-enterprise-base-rhel9
name: openshift/ose-monitoring-plugin-rhel9
payload_name: monitoring-plugin
owners:
- team-observability-ui@redhat.com
konflux:
  cachito:
    mode: emulation
  network_mode: open
