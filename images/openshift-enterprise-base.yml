base_only: true
content:
  source:
    dockerfile: Dockerfile.rhel
    git:
      branch:
        target: release-{MAJOR}.{MINOR}
      url: git@github.com:openshift-priv/images.git
      web: https://github.com/openshift/images
    path: base
    ci_alignment:
      streams_prs:
        # Try to have this PR merge as quickly as possible by pre-approving it.
        auto_label:
        - approved
        - lgtm
        merge_first: true
      # The OpenShift 4.x:base image used by numerous images in CI.
      # The problem is that the actual image is built upstream very infrequently
      # (very few changes are made to the openshift/images repo).
      # So the "normal" CI promotion logic that updates 4.x:base almost never runs.
      # This means that the 4.x:base image diverges over time from the UBI content
      # that ART is constantly updating its images with. We want 4.x:base to be
      # very similar to what we are using downstream so that CI signal represents
      # the downstream product.
      mirror: true
      # The upstream_image_base serves as a starting point for the upstream_image.
      # ART will mirror the brew build out to upstream_image_base.
      # ART does not mirror the upstream_image in this case. A buildconfig,
      # generated by images:streams is triggered when upstream_image_base is updated.
      # The output of this buildconfig is upstream_image.
      # This buildconfig layers on files necessary for the resulting upstream_image CI image
      # to pull RPM dependencies from the CDN & reposync repositories.
      upstream_image_base: registry.ci.openshift.org/ocp/builder:rhel-8-openshift-enterprise-base-{MAJOR}.{MINOR}.art
      # Note that it must be qualified by {MAJOR}.{MINOR} so that it installs non-CDN
      # rpms for the appropriate release.
      transform: rhel-8/base-repos
      # After the transform, promote directly to the location that CI promotes to. This is
      # a little sketchy, but I believe the reward is a significant improvement in CI
      # signal fidelity.
      upstream_image: registry.ci.openshift.org/ocp/{MAJOR}.{MINOR}:base
    okd_alignment:
      # The tag name in the okd stream to which this image should be promoted
      tag_name: base-stream8
      inject_rpm_repositories:
      - id: rhel-8-server-ose
        baseurl: http://base-{MAJOR}-{MINOR}-rhel8.ocp.svc/rhel-8-server-ose

distgit:
  branch: rhaos-{MAJOR}.{MINOR}-rhel-8
  component: openshift-enterprise-base-container
enabled_repos:
- rhel-8-baseos-rpms
- rhel-8-appstream-rpms
for_payload: false
for_release: false
from:
  member: openshift-base-rhel8
labels:
  License: GPLv2+
  io.k8s.description: This is the base image from which all OpenShift Container Platform images inherit.
  io.k8s.display-name: OpenShift Container Platform RHEL 8 Base
  io.openshift.tags: openshift,base
  vendor: Red Hat
name: openshift/ose-base
owners:
- lmeyer@redhat.com
